/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   matrix.c                                           :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: vcombey <marvin@42.fr>                     +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2017/09/26 17:00:44 by vcombey           #+#    #+#             */
/*   Updated: 2017/09/26 17:00:57 by vcombey          ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "rt.h"
#include <math.h>

cl_float3	mat_mult_vect(float a[3][3], cl_float3 v)
{
	cl_float3	res;

	res.x = a[0][0] * v.x + a[0][1] * v.y + a[0][2] * v.z;
	res.y = a[1][0] * v.x + a[1][1] * v.y + a[1][2] * v.z;
	res.z = a[2][0] * v.x + a[2][1] * v.y + a[2][2] * v.z;
	return (res);
}

int			invert_matrix(float m[3][3], float inv_m[3][3])
{
	float	det;

	det = m[0][0] * (m[1][1] * m[2][2] - m[2][1] * m[1][2])
		- m[0][1] * (m[1][0] * m[2][2] - m[2][0] * m[1][2])
		+ m[0][2] * (m[1][0] * m[2][1] - m[2][0] * m[1][1]);
	if (fabsf(det) < 0.0005)
		return (0);
	inv_m[0][0] = m[1][1] * m[2][2] - m[1][2] * m[2][1] / det;
	inv_m[0][1] = -(m[0][1] * m[2][2] - m[2][1] * m[0][2]) / det;
	inv_m[0][2] = m[0][1] * m[1][2] - m[1][1] * m[0][2] / det;
	inv_m[1][0] = -(m[1][0] * m[2][2] - m[1][2] * m[2][0]) / det;
	inv_m[1][1] = m[0][0] * m[2][2] - m[2][0] * m[0][2] / det;
	inv_m[1][2] = -(m[0][0] * m[1][2] - m[1][0] * m[0][2]) / det;
	inv_m[2][0] = m[1][0] * m[2][1] - m[2][0] * m[1][1] / det;
	inv_m[2][1] = -(m[0][0] * m[2][1] - m[2][0] * m[0][1]) / det;
	inv_m[2][2] = m[0][0] * m[1][1] - m[0][1] * m[1][0] / det;
	return (1);
}

void		set_rotation_matrix(float m[3][3], cl_float3 vx, cl_float3 vy, \
		cl_float3 vz)
{
	m[0][0] = vx.x;
	m[0][1] = vy.x;
	m[0][2] = vz.x;
	m[1][0] = vx.y;
	m[1][1] = vy.y;
	m[1][2] = vz.y;
	m[2][0] = vx.z;
	m[2][1] = vy.z;
	m[2][2] = vz.z;
}
